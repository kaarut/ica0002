server {
    listen 80 default_server;
    server_name _;
    
    # UWSGI 
    {% if inventory_hostname in groups['web_servers'] %}
        location / {
            uwsgi_pass localhost:5000;
            include uwsgi_params;
        }
    
    # STUB
    listen 8080 default_server;
        location = /basic_status {
                stub_status;
        }   
    {% endif %}

    # NODE EXPORTER
    location /node-metrics
        {
            proxy_pass http://localhost:9100/metrics;
        }

    # DNS_exporter 
    {% if inventory_hostname in groups['dns_servers'] %}
        location /bind-metrics  {
            proxy_pass localhost:8053;
        }
    {% endif %}

    # PROMETHEUS 
    {% if inventory_hostname in groups['prometheus'] %}
    location /prometheus
        {
            proxy_pass http://localhost:9090;
        }
    {% endif %}

}
